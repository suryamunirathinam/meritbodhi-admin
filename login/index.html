<html>
   <head>
      <meta charset="utf-8">
      <title>Merit Bodhi | Login </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.9.0/localforage.js"></script>
    
    <!-- Latest Font Icon css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--Line Awesome Icon Css-->
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
    <link rel="stylesheet" href="../css/institute.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>
    <script src="../js/connect.js"></script>
    <script src="https://kit.fontawesome.com/28d953b416.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css" integrity="sha512-ARJR74swou2y0Q2V9k0GbzQ/5vJ2RBSoCWokg4zkfM29Fb3vZEQyv0iWBMW/yvKgyHSR/7D64pFMmU8nYmbRkg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js" integrity="sha512-yDlE7vpGDP7o2eftkCiPZ+yuUyEcaBwoJoIhdXv71KZWugFqEphIS3PU60lEkFaz8RxaVsMpSvQxMBaKVwA5xg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" type="text/css" href="mobile_login.css">
    <style type="text/css">
       /*-------------------------overlay------------------------*/
.overlay {
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    position: fixed;
    background: #222;
}

.overlay__inner {
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    position: absolute;
}

.overlay__content {
    left: 50%;
    position: absolute;
    top: 50%;
    transform: translate(-50%, -50%);
}

.spinner {
    width: 75px;
    height: 75px;
    display: inline-block;
    border-width: 2px;
    border-color: rgba(255, 255, 255, 0.05);
    border-top-color: #fff;
    animation: spin 1s infinite linear;
    border-radius: 100%;
    border-style: solid;
}

@keyframes spin {
  100% {
    transform: rotate(360deg);
  }
}
 /*--------------------toast--------------------*/
  #snackbar {
      visibility: hidden;
      min-width: 250px;
      margin-left: -125px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 2px;
      padding: 16px;
      position: fixed;
      z-index: 1;
      left: 50%;
      bottom: 30px;
      font-size: 17px;
    }

    #snackbar.show {
      visibility: visible;
      -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
      animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }

    @-webkit-keyframes fadein {
      from {bottom: 0; opacity: 0;} 
      to {bottom: 30px; opacity: 1;}
    }

    @keyframes fadein {
      from {bottom: 0; opacity: 0;}
      to {bottom: 30px; opacity: 1;}
    }

    @-webkit-keyframes fadeout {
      from {bottom: 30px; opacity: 1;} 
      to {bottom: 0; opacity: 0;}
    }

    @keyframes fadeout {
      from {bottom: 30px; opacity: 1;}
      to {bottom: 0; opacity: 0;}
    }

    </style>
   </head>
   <body>
      <div id="snackbar"></div>
       <!-------------------------loading overlay--------------------------------------------------->
        <div id="loaderForDashb" class="overlay" style="display:none">
          <div class="overlay__inner">
              <div class="overlay__content"><span class="spinner"></span></div>
          </div>
      </div>
      <div class="wrapper">
         <div class="title-text">
            <div class="title login">
               Login Form
            </div>
            <div class="title signup">
               Login Form
            </div>
         </div>
         <!-- to do validation -->
         <div class="try">
         <ul class="nav nav-tabs">
                        <li class="nav-item">
                          <a class="nav-link active" data-toggle="tab" href="#home">Student</a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" data-toggle="tab" href="#menu1">Institute</a>
                        </li>
                        <li class="nav-item">
                         <a class="nav-link" data-toggle="tab" href="#menu3">Faculty</a>
                        </li>
                       </ul>
        			 <div class="tab-content">
                        <div class="tab-pane container active" id="home">
                            
                        <div class="form-inner">
               <form action="#" class="login">
                  <div class="field">
                     <input type="text" placeholder="Username or Email Address" required>
                  </div>
                  <div class="field">
                     <input type="password" placeholder="Password" required>
                  </div>
                  <div class="field btn">
                     <div class="btn-layer"></div>
                     <input type="submit" value="Student Login">
                  </div>
                  <div class="gog">
                  	<i class="fab fa-google" style="color: darkred;">&nbsp;</i>
                  	<a href="#" style="text-decoration: none; color: red;">SignIn with Google</a>
                  <p style="text-align: center;">or
                  <div class="fac">
                  	<i class="fab fa-facebook" style="color: blue;">&nbsp;</i>
                  	<a href="#" style="text-decoration: none; color: blue;">SignIn with Facebook</a>
                  </div></div>
               </form></div></div>

               <div class="tab-pane container" id="menu1">
               	
               	<div class="form-inner">
               	<form id="institute-login-details" method="POST" class="signup">
                  <div class="field">
                     <input type="text" name="iuname" placeholder="Username" required>
                  </div>
                  <div class="field">
                     <input type="password" name="ipass" placeholder="Password" required>
                  </div>
                  <div class="field btn">
                     <div class="btn-layer"></div>
                     <input type="submit" name="ins_log_in" value="Institute Login">
                     <button style="display: none;"></button>
                  </div>
               </form>
               </div></div>

               <div class="tab-pane container" id="menu3">
               	
               	<div class="form-inner">
               	<form id="faculty-login-details" class="signup">
                  <div class="field">
                     <input type="text" placeholder="Email Address" name="facuusername" required>
                  </div>
                  <div class="field">
                     <input type="password" placeholder="Password" name="facupasswd" required>
                  </div>
                  
                  <div class="field btn">
                     <div class="btn-layer"></div>
                     <input type="submit" name="fac_log_in" value="Faculty Login">
                     <button style="display: none;"></button>
                  </div>
               </form>
               </div></div>
              
              
<script>
    
   const form=document.getElementById('institute-login-details');
    
    

    //loggin in user with authentication


   form.addEventListener('submit', (e) => {
        e.preventDefault();
        var btns = document.querySelectorAll('.btn-layer');
        for (var i = 0; i < btns.length; i++) {
           btns[i].style.display="none";
        }
        var uname=form.iuname.value
        let pass=form.ipass.value;
        auth.signInWithEmailAndPassword(uname,pass).then((a)=>{
         if (a) {
            console.log(a.user.uid);
         document.getElementById('loaderForDashb').style.display="block";
         localforage.setItem("fullAuth", a.user.displayName+'-*de*-'+a.user.photoURL);     
         data.collection('institute').doc(a.user.uid).get().then((snapshot)=>{
            if(snapshot.data().isVerified==true){
                localforage.setItem('instituteDetails', snapshot.data()).then(()=>{
                    mainCArray=[];
                    subCArray=[];
                    nationalMainC=[];
                    interNationalMainC=[];
                    data.collection('category').doc('categories').get().then((arg)=>{
                        var argArray=arg.data().catDetails;
                        argArray.forEach((arrayElement)=>{
                            mainCArray.push(arrayElement.categoryName);
                            subCArray.push(arrayElement.subcategoryList);

                            if(arrayElement.type=='National' && arrayElement.isVerified==true){
                                nationalMainC.push(arrayElement.categoryName);
                            }

                            if(arrayElement.type=='International' && arrayElement.isVerified==true){
                                interNationalMainC.push(arrayElement.categoryName);
                            }
                        });

                        localforage.setItem('mainCategories', mainCArray).then(()=>{
                            localforage.setItem('subCategories', subCArray).then(()=>{
                                localforage.setItem('nationalMainC', nationalMainC).then(()=>{
                                    localforage.setItem('interNationalMainC', interNationalMainC).then(()=>{
                                        location.replace("../dashboard/");
                                    });
                                });
                            });
                        });
                    });
                })
            } else if (snapshot.data().isVerified==false && snapshot.data().rejected==true){
                localforage.setItem('instituteDetails', snapshot.data()).then(()=>{
                    location.replace("../re-apply/institute/");
                })
                
            }else{
                showToast('You are not yet verified !!');
            }
          })
            
         
         
          }
          else{
            showToast('something went wrong !!');
          }
      }).catch((e)=>{
         showToast(e.message);
      });
   });

var form2 = document.getElementById('faculty-login-details');
   form2.addEventListener('submit', (e) => {
        e.preventDefault();

        
        var btns = document.querySelectorAll('.btn-layer');
        for (var i = 0; i < btns.length; i++) {
           btns[i].style.display="none";
        }
        var uname=form2.facuusername.value
        let pass=form2.facupasswd.value;
        auth.signInWithEmailAndPassword(uname,pass).then((a)=>{
         if (a) {
            console.log(a.user.uid);
         document.getElementById('loaderForDashb').style.display="block";
         
         data.collection('faculty').doc(a.user.uid).get().then((snapshot)=>{
              if (snapshot.data().status=="Verified") {
              localforage.setItem('facultyDetails', snapshot.data()).then(()=>{

                     mainCArray=[];
                     subCArray=[];
                     nationalMainC=[];
                     interNationalMainC=[];
                     data.collection('category').doc('categories').get().then((arg)=>{
                         var argArray=arg.data().catDetails;
                          argArray.forEach((arrayElement)=>{
                              mainCArray.push(arrayElement.categoryName);
                              subCArray.push(arrayElement.subcategoryList);

                              if(arrayElement.type=='National' && arrayElement.isVerified==true){
                                  nationalMainC.push(arrayElement.categoryName);
                              }

                              if(arrayElement.type=='International' && arrayElement.isVerified==true){
                                  interNationalMainC.push(arrayElement.categoryName);
                              }
                          });

                          localforage.setItem('mainCategories', mainCArray).then(()=>{
                              localforage.setItem('subCategories', subCArray).then(()=>{
                                  localforage.setItem('nationalMainC', nationalMainC).then(()=>{
                                      localforage.setItem('interNationalMainC', interNationalMainC).then(()=>{
                                          localforage.getItem('facultyDetails').then((a)=>{
                                            localforage.setItem("fullAuthF", a.name+'-*de*-'+a.profileImage);     
                                          })
                                          location.replace("../faculty-dashboard/");
                                      });
                                  });
                              });
                          });
                      });
              })
                }
                else if (snapshot.data().status=="Rejected") {
                    localforage.setItem('facultyDetails', snapshot.data()).then(()=>{
                        location.replace("../re-apply/faculty/");
                    })
                }
                else{
                    showToast('You are not yet Verified!!');
                }
              
          })
            
         
         
          }
          else{
            showToast('something went wrong !!');
          }
      }).catch((e)=>{
         showToast(e.message);
      });
   });
   function showToast(msg) {
          var x = document.getElementById("snackbar");
          x.innerHTML=msg;
          x.className = "show";
          setTimeout(function(){ x.className = x.className.replace("show", ""); }, 2000);
        }
      
</script>
</body>
</html>