<!doctype html>
<html lang="en">
 
<head>
    <!-- Required meta tags -->

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="../assets/libs/css/newprofile.css"> -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.9.0/firebase-auth.js"></script>
    <script src="../js/connect.js"></script>
    
    <link rel="icon" href="../assets/images/header-logo2.png" type="image/x-icon">
    <link rel="stylesheet" href="../assets/vendors/bootstrap/css/bootstrap.min.css">
    <link href="../assets/vendors/fonts/circular-std/style.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/libs/css/style.css">
    <link rel="stylesheet" type="text/css" href="manage-category.css">
    <link rel="stylesheet" href="../assets/vendors/fonts/fontawesome/css/fontawesome-all.css">
    <link rel="stylesheet" href="../assets/vendors/charts/chartist-bundle/chartist.css">
    <link rel="stylesheet" href="../assets/vendors/charts/morris-bundle/morris.css">
    <link rel="stylesheet" href="../assets/vendors/fonts/material-design-iconic-font/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../assets/vendors/charts/c3charts/c3.css">
    <link rel="stylesheet" href="../assets/vendors/fonts/flag-icon-css/flag-icon.min.css">
    <script src="https://kit.fontawesome.com/28d953b416.js" crossorigin="anonymous"></script>
    <script src="../js/admin-setup.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.9.0/localforage.js"></script>
    
    <title>Meritbothi | Manage-Category</title>
    <!-- cdns for custom multi select -->
</head>

<body>
    <!-- ============================================================== -->
    <!-- main wrapper -->
    <!-- ============================================================== -->
    <div class="dashboard-main-wrapper">
        <!-- ============================================================== -->
        <!-- navbar -->
        <!-- ============================================================== -->
        <div class="dashboard-header">
            <nav class="navbar topbar-rr navbar-expand-lg bg-white fixed-top">
                <a class="navbar-brand" href="index.html" style="font-size: 23px;">Meritbothi</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse " id="navbarSupportedContent">
                    <ul class="navbar-nav ml-auto navbar-right-top">
                        
                        <li class="nav-item dropdown notification">
                            <a class="nav-link nav-icons" href="#" id="navbarDropdownMenuLink1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-fw fa-bell"></i> <span>5</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-right notification-dropdown">
                                <li>
                                    <div class="notification-title"> Notification</div>
                                    <div class="notification-list">
                                        <div class="list-group">
                                            <a href="#" class="list-group-item list-group-item-action active">
                                                <div class="notification-info">
                                                    <div class="notification-list-user-img"><img src="../assets/images/avatar-2.jpg" alt="" class="user-avatar-md rounded-circle"></div>
                                                    <div class="notification-list-user-block"><span class="notification-list-user-name">Kishor</span>accepted your invitation to join the team.
                                                        <div class="notification-date">2 min ago</div>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action">
                                                <div class="notification-info">
                                                    <div class="notification-list-user-img"><img src="../assets/images/avatar-3.jpg" alt="" class="user-avatar-md rounded-circle"></div>
                                                    <div class="notification-list-user-block"><span class="notification-list-user-name">Bharath </span>is now following you
                                                        <div class="notification-date">2 days ago</div>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action">
                                                <div class="notification-info">
                                                    <div class="notification-list-user-img"><img src="../assets/images/avatar-4.jpg" alt="" class="user-avatar-md rounded-circle"></div>
                                                    <div class="notification-list-user-block"><span class="notification-list-user-name">Sudhersun</span> is watching your main repository
                                                        <div class="notification-date">2 min ago</div>
                                                    </div>
                                                </div>
                                            </a>
                                            <a href="#" class="list-group-item list-group-item-action">
                                                <div class="notification-info">
                                                    <div class="notification-list-user-img"><img src="../assets/images/avatar-5.jpg" alt="" class="user-avatar-md rounded-circle"></div>
                                                    <div class="notification-list-user-block"><span class="notification-list-user-name">Sandy</span>accepted your invitation to join the team.
                                                        <div class="notification-date">2 min ago</div>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="list-footer"> <a href="#">View all notifications</a></div>
                                </li>
                            </ul>
                        </li>
                       
                        <li class="nav-item dropdown nav-user">
                            <a class="nav-link nav-user-img" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="../images/admin.png" alt="" class="user-avatar-md rounded-circle" id="smallProfileImage"></a>
                            <div class="dropdown-menu dropdown-menu-right nav-user-dropdown" aria-labelledby="navbarDropdownMenuLink2">
                                <div class="nav-user-info">
                                    <h5 class="mb-0 text-white nav-user-name" id="iName">Black</h5>
                                    <span class="status"></span><span class="ml-2">Available</span>
                                </div>
                                <a class="dropdown-item" href="#"><i class="fas fa-user mr-2"></i>Account</a>
                                <a class="dropdown-item" href="#"><i class="fas fa-cog mr-2"></i>Setting</a>
                                <a class="dropdown-item" onclick="logout()" href="#"><i class="fas fa-power-off mr-2"></i>Logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <!-- ============================================================== -->
        <!-- end navbar -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- left sidebar -->
        <!-- ============================================================== -->
        
        <div class="nav-left-sidebar sidebar-white">
            <div class="menu-list">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <a class="d-xl-none d-lg-none" href="../dashboard">Merit Bodhi</a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav flex-column">
                            <li class="nav-item ">
                                <a class="nav-link" href="../manage-dashboard"><i class="fas fa-chart-pie"></i>Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../manage-institute" ><i class="fas fa-university"></i>Institute's</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../manage-faculty"><i class="fas fa-chalkboard-teacher"></i>Faculty</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="../manage-courses"><i class="fas fa-book"></i>Courses</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="../manage-category" ><i class="fas fa-sort-amount-down"></i>Category</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../manage-payments" ><i class="fas fa-credit-card"></i>Payments</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../manage-report" ><i class="fas fa-flag"></i>Report Generation</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link " href="../manage-complaints" ><i class="fas fa-question-circle"></i>Complaints</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="../manage-addadmins" ><i class="fas fa-plus-square"></i>Add Admins</a>
                            </li>
                            <li class="nav-item hi-sh-lg">
                                <a class="nav-link" href="#" onclick="logout()"><i class="fas fa-power-off"></i>Logout</a>
                                 </li>
                                </ul>
                                </div>
                                </nav>
                                </div>
                                </div>
        <!-- ============================================================== -->
        <!-- end left sidebar -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- wrapper  -->
        <!-- ============================================================== -->
        <div class="dashboard-wrapper"> <!-- DASH WRAPPER DIV -->
          <div class="dashboard-ecommerce"> <!-- DASH E-COMM DIV -->
            
            <!-- <div class="backround">
                <h3>Search Institute name for finding the Category</h3>
                <div class="searchboxclass">
                    <input type="text" class="form-control inputsize" name="searchbox" placeholder="Institute Name...">
                    <button class="fas fa-search searchicon" type="submit"></button>
                </div>
            </div> -->

            <div class="backround" id="completetable">
                <div>
                <button class="btn btn-sm btn-primary addnew" onclick="newcategory()"> Add new </button>
                    </div>
                    <div class="formobile">
                        <table class="table table-bordered needchanges1">
                          <thead>
                            <tr>
                              <th scope="col">No.</th>
                              <th scope="col" class="mc">Main Category</th>
                              <th scope="col" class="sc">Sub Category</th>
                              <th scope="col" class="sc">Type</th>
                              <th scope="col" class="styles">Action</th>
                            </tr>
                          </thead>
                          <tbody id="existingCatsBody">
                            <!-- <tr>
                              <th scope="row">1</th>
                              <td>TNPSC</td>
                              <td>GROUP-1, GROUP-3, GROUP-4</td>
                              <td><i class="fas fa-pen" style="color: #5e72e4; cursor: pointer; cursor: pointer;" 
                                onclick="foredit(this)"></i> &nbsp; &nbsp; <i class="fas fa-trash" style="color: red; 
                                cursor: pointer;" id="deletethis"></i></td>
                            </tr>
                            <tr>
                              <th scope="row">2</th>
                              <td>Jacob</td>
                              <td>Otto</td>
                              <td><i class="fas fa-pen" style="color: #5e72e4; cursor: pointer;"></i> &nbsp; &nbsp; <i class="fas fa-trash" style="color: red; cursor: pointer;"></i></td>
                            </tr>
                            <tr>
                              <th scope="row">3</th>
                              <td>Larry the Bird</td>
                              <td>Otto</td>
                              <td><i class="fas fa-pen" style="color: #5e72e4; cursor: pointer;"></i> &nbsp; &nbsp; <i class="fas fa-trash" style="color: red; cursor: pointer;"></i></td>
                            </tr> -->
                          </tbody>
                        </table>
                    </div>
                </div>
                <!-- SECOND -->
               
                   
                </div>
                </div>



    <!-- DEFAULT CONTENT -->

        <div id="snackbar"></div>
    <!-- temprory loading -->
    <button type="button" id="loaderTrigger" class="btn btn-primary" data-toggle="modal" data-target="#loaderModal" style="display: none;">
    </button>

    <!-- Modal -->
    <div class="modal" id="loaderModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="loaderModalTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered d-flex justify-content-center" role="document">
        <div class="modal-content temp-loader">
          <div class="modal-header" style="display: none;">
                <h5 class="modal-title" id="loaderModalTitle">Modal title</h5>
                <button id="closeLoader" type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
            </div>
          <div class="modal-body">
            <div class="d-flex">
                <div>
                    <img style="height:50px" src="../assets/images/loader.gif">
                </div>
                <div style="margin-top: 0.7rem; font-size:1.25rem"><strong>Loading...</strong></div>
            </div>
          </div>
          
        </div>
      </div>
    </div>

    <!-- DEFAULT CONTENT END -->


    <!-- MODAL'S -->

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#staticBackdrop" id="addnewcat" style="display: none;">
      Launch static backdrop modal
    </button>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">New Category's</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="catstyles">
                <form id="catNewForm" name="catNewForm">
                <div class="catstyles1">
                    <div style="margin-bottom: .5rem;">Main Category :</div>
                    <input type="text" class="form-control" name="newmaincat" placeholder="main category">
                </div><br>
                <div class="subcat">Sub Category :</div>
                <small class="subcat1">enter subcategories separated by comma (,)</small>
                <div class="catstyles2">
                    <input type="text" class="form-control" name="newSubCat" placeholder="sub category">
                    
                </div>
                <div class="catstyles3"></div>
                <div><select id="typeSelect" name="selNAme">
                    <option value="default">---select---</option>
                    <option value="National">National</option>
                    <option value="International">International</option>
                </select></div>
            </form>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" onclick="addCategory()">Add</button> &nbsp; &nbsp;
            <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" style="background-color:red">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- END MODAL'S -->

    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#staticBackdrop1" id="editnewcat" 
    style="display: none;">
      Launch static backdrop modal
    </button>

    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop1" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Edit Category</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="catstyles">
                <form name="catUpForm" id="catUpForm">
                <div class="catstyles1">
                    <div style="margin-bottom: .5rem;">Main Category :</div>
                    <input type="text" class="form-control" name="upmaincat" >
                </div><br>
                <div class="subcat1">Sub Category :</div>
                <small class="subcat1">enter sub categeries seprated by comma (,)</small>
                <div class="catstyles2">
                    <input type="text" class="form-control" name="upSubCat" >
                </div>
                <div class="catstyles33"></div>
            </form>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-sm btn-primary">Add</button> &nbsp; &nbsp;
            <button type="button" class="btn btn-sm btn-primary" data-dismiss="modal" style="background-color:red">Cancel</button>
          </div>
        </div>
      </div>
    </div>

    <!-- END MODAL'S -->

    <script type="text/javascript">
        document.getElementById('iName').innerHTML=sessionStorage.getItem('name');
        
        var uid='';
        auth.onAuthStateChanged((user)=>{
            if(user){
                uid=user.uid;
            }else{
                location.replace('../admin-login/');
            }
        })

        onload = () =>{
            loaderTriggerAndEnder(true);
            $('#reqCatsBody').html('');
            $('#existingCatsBody').html('');
            var i=0,k=0,l=0;
            data.collection('category').doc('categories').get().then((snapshot)=>{
                var catArray=snapshot.data().catDetails;

                catArray.forEach((doccc)=>{
                    k++;
                    if(doccc.isVerified==true){
                        i++;
                        var tempString='',j=0;
                        doccc.subcategoryList.forEach((datata)=>{
                            if(j==0){
                                j++;
                                tempString=datata.subCategoryName;
                            }else{
                                tempString+=','+datata.subCategoryName;
                            }
                        })
                        var existingString=`<tr>
                                  <th scope="row">`+i+`</th>
                                  <td>`+doccc.categoryName+`</td>
                                  <td>`+tempString+`</td>
                                  <td>`+doccc.type+`</td>
                                  <td><i class="fas fa-pen" style="color: #5e72e4; cursor: pointer;"></i> &nbsp; &nbsp; <i class="fas fa-trash" style="color: red; cursor: pointer;"></i></td>
                                </tr>`;
                        $('#existingCatsBody').append(existingString);
                    }else{
                        l++;

                        if(doccc.subcategoryList.length==1){
                            var reqString=`<tr>
                                  <th scope="row">`+l+`</th>
                                  <td>Main Category</td>                              
                                  <td>`+doccc.categoryName+`</td>
                                  <td>`+doccc.subcategoryList[0].subCategoryName+`</td>
                                  <td><i class="fas fa-check" onclick="acceptCategory(this)" data-name="`+doccc.categoryName+`" style="color: green; cursor: pointer;"></i> &nbsp; &nbsp; <i class="fas fa-times" onclick="rejectCategory(this)" data-name="`+doccc.categoryName+`" style="color: red; cursor: pointer;"></i></td>
                                </tr>`;
                            $('#reqCatsBody').append(reqString);
                        }else{
                            var reqString=`<tr>
                                  <th scope="row">`+l+`</th>
                                  <td>Sub Category</td>                              
                                  <td>`+doccc.categoryName+`</td>
                                  <td>`+doccc.subcategoryList[doccc.subcategoryList.length-1].subCategoryName+`</td>
                                  <td><i class="fas fa-check" data-name="`+doccc.categoryName+`" onclick="acceptCategory(this)" style="color: green; cursor: pointer;"></i> &nbsp; &nbsp; <i class="fas fa-times" onclick="rejectCategory(this)" data-name="`+doccc.categoryName+`" style="color: red; cursor: pointer;"></i></td>
                                </tr>`;
                            $('#reqCatsBody').append(reqString);
                        }
                    }
                    if(k==catArray.length){
                        loaderTriggerAndEnder(false);
                    }
                })
            })
        }

        newcategory = () => {
            document.getElementById('addnewcat').click();
        }

        foredit = (d) => {
            var mcats = d.getAttribute('mainCat-edits');
            var scats = d.getAttribute('subCats-edits');
            document.getElementById('upmaincat').value=mcats;
            document.getElementById('upSubCat').value=scats;
            document.getElementById('editnewcat').click();
        }

        acceptCategory = async (b) =>{
            loaderTriggerAndEnder(true);
            var name=b.getAttribute('data-name');

            var catArray = await data.collection('category').doc('categories').get();
            var temp=[];
            catArray.data().catDetails.forEach((ddd)=>{
                if(ddd.categoryName==name){
                    ddd.isVerified=true;
                    temp.push(ddd);
                }else{
                    temp.push(ddd);
                }
            })

            data.collection('category').doc('categories').update({
                catDetails: temp
            }).then(()=>{
                onload();
                loaderTriggerAndEnder(false);
            })
        }

        addCategory = () => {
            if(confirm("Do you want to create this Category ? ")){
                loaderTriggerAndEnder(true);
                var form = document.getElementById('catNewForm');

                var main=form.newmaincat.value;
                var sub=form.newSubCat.value;
                var type=form.selNAme.value;

                var mainArray={};

                mainArray.categoryName=main.toLowerCase();
                mainArray.isVerified=true;
                mainArray.noOfCourses=0;
                mainArray.subcategoryList=[];
                mainArray.subcollection=main.toLowerCase();
                mainArray.type=type;

                var subCategoryArray=sub.split(','),i=0;

                subCategoryArray.forEach((subCat)=>{
                    i++;

                    var subbb=subCat.trim().toLowerCase();

                    data.collection('subCategories').add({
                        id: '',
                        noOfCourses: 0,
                        subCategory: subbb
                    }).then((docid)=>{
                        data.collection('subCategories').doc(docid.id).update({
                            id: docid.id
                        }).then(()=>{
                            mainArray.subcategoryList.push({
                                subCategoryId: docid.id,
                                subCategoryName: subbb
                            });

                            if(i==subCategoryArray.length){
                                data.collection('category').doc('categories').get().then((snaanam)=>{
                                    var catDetailssss=snaanam.data().catDetails;

                                    catDetailssss.push(mainArray);

                                    data.collection('category').doc('categories').update({
                                        catDetails: catDetailssss
                                    }).then(()=>{
                                        onload();
                                        loaderTriggerAndEnder(false);
                                    })
                                })
                            }
                        })
                    })
                })
            }
        }

    </script>
    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="../assets/vendors/jquery/jquery-3.3.1.min.js"></script>
    <script src="../assets/vendors/bootstrap/js/bootstrap.bundle.js"></script>
    <script src="../assets/vendors/charts/chartist-bundle/chartist.min.js"></script>
    
</body>
<!-- primary color : #5e72e4 -->
</html>